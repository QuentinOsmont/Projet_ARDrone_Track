<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Urbi SDK Remote: main.cc Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath">
    <ul>
      <li><a class="el" href="dir_03c25b13d14c5db4475ec8bbd24b0f1f.html">source</a>      </li>
      <li><a class="el" href="dir_218aef791fc34308040010d988450d4d.html">sdk-remote</a>      </li>
      <li><a class="el" href="dir_8936cf83ad6d7e6892ca1b54c991a702.html">src</a>      </li>
      <li><a class="el" href="dir_ce7892fd3741598588e2efda9b4f60f6.html">libuobject</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<h1>main.cc</h1>  </div>
</div>
<div class="contents">
<a href="main_8cc.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * Copyright (C) 2008-2010, Gostai S.A.S.</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * This software is provided &quot;as is&quot; without warranty of any kind,</span>
<a name="l00005"></a>00005 <span class="comment"> * either expressed or implied, including but not limited to the</span>
<a name="l00006"></a>00006 <span class="comment"> * implied warranties of fitness for a particular purpose.</span>
<a name="l00007"></a>00007 <span class="comment"> *</span>
<a name="l00008"></a>00008 <span class="comment"> * See the LICENSE file for more information.</span>
<a name="l00009"></a>00009 <span class="comment"> */</span>
<a name="l00010"></a>00010 
<a name="l00012"></a>00012 
<a name="l00013"></a>00013 <span class="preprocessor">#include &lt;libport/cstdio&gt;</span>
<a name="l00014"></a>00014 <span class="preprocessor">#include &lt;libport/unistd.h&gt;</span>
<a name="l00015"></a>00015 <span class="preprocessor">#include &lt;libport/cerrno&gt;</span>
<a name="l00016"></a>00016 
<a name="l00017"></a>00017 <span class="preprocessor">#include &lt;iostream&gt;</span>
<a name="l00018"></a>00018 <span class="preprocessor">#include &lt;list&gt;</span>
<a name="l00019"></a>00019 <span class="preprocessor">#include &lt;sstream&gt;</span>
<a name="l00020"></a>00020 
<a name="l00021"></a>00021 <span class="preprocessor">#include &lt;libport/debug.hh&gt;</span>
<a name="l00022"></a>00022 <span class="preprocessor">#include &lt;libport/cli.hh&gt;</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include &lt;libport/containers.hh&gt;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &lt;libport/foreach.hh&gt;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &lt;libport/lexical-cast.hh&gt;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &lt;libport/package-info.hh&gt;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &lt;libport/program-name.hh&gt;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &lt;libport/sysexits.hh&gt;</span>
<a name="l00029"></a>00029 
<a name="l00030"></a>00030 <span class="preprocessor">#include &lt;<a class="code" href="package-info_8hh.html">urbi/package-info.hh</a>&gt;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &lt;<a class="code" href="uexternal_8hh.html">urbi/uexternal.hh</a>&gt;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &lt;<a class="code" href="umain_8hh.html">urbi/umain.hh</a>&gt;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &lt;<a class="code" href="umessage_8hh.html">urbi/umessage.hh</a>&gt;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &lt;<a class="code" href="uobject_8hh.html">urbi/uobject.hh</a>&gt;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &lt;<a class="code" href="urbi-root_8hh.html">urbi/urbi-root.hh</a>&gt;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &lt;<a class="code" href="usyncclient_8hh.html" title="Definition of the URBI interface class.">urbi/usyncclient.hh</a>&gt;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &lt;<a class="code" href="remote-ucontext-impl_8hh.html">libuobject/remote-ucontext-impl.hh</a>&gt;</span>
<a name="l00038"></a>00038 <span class="keyword">using</span> libport::program_name;
<a name="l00039"></a>00039 
<a name="l00040"></a>00040 <a class="code" href="uobject-common_8cc.html#a2732044fb4a85ef4edd80daf89b37efb">GD_CATEGORY</a>(urbi-launch);
<a name="l00041"></a>00041 
<a name="l00042"></a>00042 <span class="keyword">namespace </span>urbi
<a name="l00043"></a>00043 {
<a name="l00044"></a><a class="code" href="namespaceurbi.html#abde41f38d8a74367f06a0ebc1fe20fe9">00044</a>   <span class="keyword">static</span> <a class="code" href="classurbi_1_1impl_1_1_remote_u_context_impl.html">impl::RemoteUContextImpl</a>* <a class="code" href="namespaceurbi.html#abde41f38d8a74367f06a0ebc1fe20fe9">defaultContext</a>;
<a name="l00045"></a>00045 
<a name="l00046"></a>00046   <a class="code" href="namespaceurbi.html#a63f30f52002e7e7f853a12a8c1172f41" title="Return values for the callcack functions.">UCallbackAction</a>
<a name="l00047"></a><a class="code" href="namespaceurbi.html#a2e6c3f8678045bd7fa7273483863fb8e">00047</a>   <a class="code" href="namespaceurbi.html#a2e6c3f8678045bd7fa7273483863fb8e">debug</a>(<span class="keyword">const</span> <a class="code" href="classurbi_1_1_u_message.html" title="Class containing all informations related to an URBI message.">UMessage</a>&amp; msg)
<a name="l00048"></a>00048   {
<a name="l00049"></a>00049     GD_SWARN(<span class="stringliteral">&quot;unexpected message &quot;</span> &lt;&lt; msg);
<a name="l00050"></a>00050     <span class="keywordflow">return</span> URBI_CONTINUE;
<a name="l00051"></a>00051   }
<a name="l00052"></a>00052 
<a name="l00053"></a>00053   <a class="code" href="namespaceurbi.html#a63f30f52002e7e7f853a12a8c1172f41" title="Return values for the callcack functions.">UCallbackAction</a>
<a name="l00054"></a>00054   <span class="keyword">static</span>
<a name="l00055"></a><a class="code" href="namespaceurbi.html#aeab843c89fdb8c3cd441703535bd7aaa">00055</a>   <a class="code" href="namespaceurbi.html#aeab843c89fdb8c3cd441703535bd7aaa">endProgram</a>(<span class="keyword">const</span> <a class="code" href="classurbi_1_1_u_message.html" title="Class containing all informations related to an URBI message.">UMessage</a>&amp; msg)
<a name="l00056"></a>00056   {
<a name="l00057"></a>00057     GD_SWARN(<span class="stringliteral">&quot;got a disconnection message: &quot;</span>&lt;&lt; msg);
<a name="l00058"></a>00058     <a class="code" href="namespaceurbi.html#ae2d61f9a8e2c575f660323f0fe01f646" title="Terminate your URBI program.">exit</a>(1);
<a name="l00059"></a>00059     <span class="keywordflow">return</span> URBI_CONTINUE; <span class="comment">//stupid gcc</span>
<a name="l00060"></a>00060   }
<a name="l00061"></a>00061 
<a name="l00062"></a>00062   <span class="keyword">static</span>
<a name="l00063"></a>00063   <span class="keywordtype">void</span>
<a name="l00064"></a><a class="code" href="namespaceurbi.html#a522d50415793bfb01630e57fc41b130a">00064</a>   <a class="code" href="namespaceurbi.html#a522d50415793bfb01630e57fc41b130a">usage</a>()
<a name="l00065"></a>00065   {
<a name="l00066"></a>00066     std::cout &lt;&lt;
<a name="l00067"></a>00067       <span class="stringliteral">&quot;usage:\n&quot;</span> &lt;&lt; libport::program_name() &lt;&lt; <span class="stringliteral">&quot; [OPTION]...\n&quot;</span>
<a name="l00068"></a>00068       <span class="stringliteral">&quot;\n&quot;</span>
<a name="l00069"></a>00069       <span class="stringliteral">&quot;Options:\n&quot;</span>
<a name="l00070"></a>00070       <span class="stringliteral">&quot;  -b, --buffer SIZE     input buffer size&quot;</span>
<a name="l00071"></a>00071                  &lt;&lt; <span class="stringliteral">&quot; [&quot;</span> &lt;&lt; <a class="code" href="classurbi_1_1_u_abstract_client.html#ae894e1c0426745f52f24591662d68882a20c1519486115b466ec04f8b0876dfe7">UAbstractClient::URBI_BUFLEN</a> &lt;&lt; <span class="stringliteral">&quot;]\n&quot;</span>
<a name="l00072"></a>00072       <span class="stringliteral">&quot;  -h, --help            display this message and exit\n&quot;</span>
<a name="l00073"></a>00073       <span class="stringliteral">&quot;  -H, --host ADDR       server host name&quot;</span>
<a name="l00074"></a>00074                  &lt;&lt; <span class="stringliteral">&quot; [&quot;</span> &lt;&lt; <a class="code" href="classurbi_1_1_u_abstract_client.html#ab01e33f972ab1bff5058b26fc43305ca" title="Default host.">UClient::default_host</a>() &lt;&lt; <span class="stringliteral">&quot;]\n&quot;</span>
<a name="l00075"></a>00075       <span class="stringliteral">&quot;      --server          put remote in server mode\n&quot;</span>
<a name="l00076"></a>00076       <span class="stringliteral">&quot;      --no-sync-client  Use UClient instead of USyncClient\n&quot;</span>
<a name="l00077"></a>00077       <span class="stringliteral">&quot;  -p, --port PORT       tcp port URBI will listen to&quot;</span>
<a name="l00078"></a>00078                  &lt;&lt; <span class="stringliteral">&quot; [&quot;</span> &lt;&lt; <a class="code" href="classurbi_1_1_u_abstract_client.html#a286390af4bea2f1caa8fb8db95321bcbaa6429e7d47bbe14ebb0c0308cb46bb8b">UAbstractClient::URBI_PORT</a> &lt;&lt; <span class="stringliteral">&quot;]\n&quot;</span>
<a name="l00079"></a>00079       <span class="stringliteral">&quot;  -r, --port-file FILE  file containing the port to listen to\n&quot;</span>
<a name="l00080"></a>00080       <span class="stringliteral">&quot;  -V, --version         print version information and exit\n&quot;</span>
<a name="l00081"></a>00081       <span class="stringliteral">&quot;  -d, --disconnect      exit program if disconnected(defaults)\n&quot;</span>
<a name="l00082"></a>00082       <span class="stringliteral">&quot;  -s, --stay-alive      do not exit program if disconnected\n&quot;</span>
<a name="l00083"></a>00083       <span class="stringliteral">&quot;  --describe            describe loaded UObjects and exit\n&quot;</span>
<a name="l00084"></a>00084       <span class="stringliteral">&quot;  --describe-file FILE  write the list of present UObjects to FILE\n&quot;</span>
<a name="l00085"></a>00085                  &lt;&lt; <a class="code" href="namespaceurbi.html#ae2d61f9a8e2c575f660323f0fe01f646" title="Terminate your URBI program.">libport::exit</a> (EX_OK);
<a name="l00086"></a>00086   }
<a name="l00087"></a>00087 
<a name="l00088"></a>00088   <span class="keyword">static</span>
<a name="l00089"></a>00089   <span class="keywordtype">void</span>
<a name="l00090"></a><a class="code" href="namespaceurbi.html#a22d6748700e48c56d7ba124c0344c13e">00090</a>   <a class="code" href="namespaceurbi.html#a22d6748700e48c56d7ba124c0344c13e">version</a>()
<a name="l00091"></a>00091   {
<a name="l00092"></a>00092     std::cout &lt;&lt; <a class="code" href="namespaceurbi.html#a01c36ddfb0739e7c0399b4bdb85e3bef" title="Package information about liburbi and UObjects.">urbi::package_info</a>() &lt;&lt; std::endl
<a name="l00093"></a>00093               &lt;&lt; <a class="code" href="namespaceurbi.html#ae2d61f9a8e2c575f660323f0fe01f646" title="Terminate your URBI program.">libport::exit</a> (EX_OK);
<a name="l00094"></a>00094   }
<a name="l00095"></a>00095 
<a name="l00096"></a><a class="code" href="namespaceurbi.html#a47b62fb257e1207893b3fbd9e2a88156">00096</a>   <span class="keyword">typedef</span> std::vector&lt;std::string&gt; files_type;
<a name="l00097"></a>00097   <span class="keywordtype">int</span>
<a name="l00098"></a><a class="code" href="namespaceurbi.html#ae40876f9d414812e448a69599fb5dc16">00098</a>   <a class="code" href="namespaceurbi.html#ae40876f9d414812e448a69599fb5dc16">initialize</a>(<span class="keyword">const</span> std::string&amp; host, <span class="keywordtype">int</span> port, <span class="keywordtype">size_t</span> buflen,
<a name="l00099"></a>00099              <span class="keywordtype">bool</span> exitOnDisconnect, <span class="keywordtype">bool</span> server, <span class="keyword">const</span> <a class="code" href="namespaceurbi.html#a47b62fb257e1207893b3fbd9e2a88156">files_type</a>&amp; files,
<a name="l00100"></a>00100              <span class="keywordtype">bool</span> useSyncClient)
<a name="l00101"></a>00101   {
<a name="l00102"></a>00102     std::cerr &lt;&lt; program_name()
<a name="l00103"></a>00103               &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; <a class="code" href="namespaceurbi.html#a01c36ddfb0739e7c0399b4bdb85e3bef" title="Package information about liburbi and UObjects.">urbi::package_info</a>() &lt;&lt; std::endl
<a name="l00104"></a>00104               &lt;&lt; program_name()
<a name="l00105"></a>00105               &lt;&lt; <span class="stringliteral">&quot;: Remote Component Running on &quot;</span>
<a name="l00106"></a>00106               &lt;&lt; host &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; port &lt;&lt; std::endl;
<a name="l00107"></a>00107     <span class="keywordflow">if</span> (useSyncClient)
<a name="l00108"></a>00108     {
<a name="l00109"></a>00109       <a class="code" href="structurbi_1_1_u_sync_client_1_1options.html" title="Option structure for USyncClient construction.">USyncClient::options</a> o;
<a name="l00110"></a>00110       o.server(server);
<a name="l00111"></a>00111       <span class="keyword">new</span> <a class="code" href="classurbi_1_1_u_sync_client.html" title="UClient linux implementation with support for synchronous extra functions.">USyncClient</a>(host, port, buflen, o);
<a name="l00112"></a>00112     }
<a name="l00113"></a>00113     <span class="keywordflow">else</span>
<a name="l00114"></a>00114     {
<a name="l00115"></a>00115       std::cerr &lt;&lt; <span class="stringliteral">&quot;#WARNING: the no-sync-client mode is dangerous.\n&quot;</span>
<a name="l00116"></a>00116         <span class="stringliteral">&quot;Any attempt to use synchronous operation will crash your program.&quot;</span>
<a name="l00117"></a>00117         &lt;&lt; std::endl;
<a name="l00118"></a>00118       <a class="code" href="structurbi_1_1_u_client_1_1options.html" title="Construction options.">UClient::options</a> o;
<a name="l00119"></a>00119       o.server(server);
<a name="l00120"></a>00120       <a class="code" href="namespaceurbi.html#aef74fc0742be0966b175731a3806e8b0" title="Redefine the default client.">setDefaultClient</a>(<span class="keyword">new</span> <a class="code" href="classurbi_1_1_u_client.html" title="Linux implementation of UAbstractClient.">UClient</a>(host, port, buflen, o));
<a name="l00121"></a>00121     }
<a name="l00122"></a>00122     <span class="keywordflow">if</span> (exitOnDisconnect)
<a name="l00123"></a>00123     {
<a name="l00124"></a>00124       <span class="keywordflow">if</span> (!<a class="code" href="namespaceurbi.html#a9586227e53bd2feae43f1010afc1d6fa" title="Return the first UClient created by the program.">getDefaultClient</a>() || <a class="code" href="namespaceurbi.html#a9586227e53bd2feae43f1010afc1d6fa" title="Return the first UClient created by the program.">getDefaultClient</a>()-&gt;error())
<a name="l00125"></a>00125         std::cerr &lt;&lt; <span class="stringliteral">&quot;ERROR: failed to connect, exiting...&quot;</span> &lt;&lt; std::endl
<a name="l00126"></a>00126                   &lt;&lt; <a class="code" href="namespaceurbi.html#ae2d61f9a8e2c575f660323f0fe01f646" title="Terminate your URBI program.">libport::exit</a>(1);
<a name="l00127"></a>00127       <a class="code" href="namespaceurbi.html#a9586227e53bd2feae43f1010afc1d6fa" title="Return the first UClient created by the program.">getDefaultClient</a>()-&gt;<a class="code" href="classurbi_1_1_u_abstract_client.html#a92f7ea2d9eebc3ea8a8b2d1b8f147a55" title="Associate a callback with local connection errors.">setClientErrorCallback</a>(<a class="code" href="namespaceurbi.html#a384e3312cf097fdbbe068d2647f46f13" title="Generate a callback wrapper used by UAbstractClient::setCallback().">callback</a>(&amp;<a class="code" href="namespaceurbi.html#aeab843c89fdb8c3cd441703535bd7aaa">endProgram</a>));
<a name="l00128"></a>00128     }
<a name="l00129"></a>00129     <span class="keywordflow">if</span> (!<a class="code" href="namespaceurbi.html#a9586227e53bd2feae43f1010afc1d6fa" title="Return the first UClient created by the program.">getDefaultClient</a>() || <a class="code" href="namespaceurbi.html#a9586227e53bd2feae43f1010afc1d6fa" title="Return the first UClient created by the program.">getDefaultClient</a>()-&gt;error())
<a name="l00130"></a>00130       <span class="keywordflow">return</span> 1;
<a name="l00131"></a>00131 
<a name="l00132"></a>00132 <span class="preprocessor">#ifdef LIBURBIDEBUG</span>
<a name="l00133"></a>00133 <span class="preprocessor"></span>    <a class="code" href="namespaceurbi.html#a9586227e53bd2feae43f1010afc1d6fa" title="Return the first UClient created by the program.">getDefaultClient</a>()-&gt;<a class="code" href="classurbi_1_1_u_abstract_client.html#a161dc8bb4e50bf63a9f666c9a3722ec7" title="Associate a callback with all messages.">setWildcardCallback</a>(<a class="code" href="namespaceurbi.html#a384e3312cf097fdbbe068d2647f46f13" title="Generate a callback wrapper used by UAbstractClient::setCallback().">callback</a>(&amp;<a class="code" href="namespaceurbi.html#a2e6c3f8678045bd7fa7273483863fb8e">debug</a>));
<a name="l00134"></a>00134 <span class="preprocessor">#else</span>
<a name="l00135"></a>00135 <span class="preprocessor"></span>    <a class="code" href="namespaceurbi.html#a9586227e53bd2feae43f1010afc1d6fa" title="Return the first UClient created by the program.">getDefaultClient</a>()-&gt;<a class="code" href="classurbi_1_1_u_abstract_client.html#ad761d3d126c0ac2438bec78739a81a86" title="Associate a callback function with all error messages from the server.">setErrorCallback</a>(<a class="code" href="namespaceurbi.html#a384e3312cf097fdbbe068d2647f46f13" title="Generate a callback wrapper used by UAbstractClient::setCallback().">callback</a>(&amp;<a class="code" href="namespaceurbi.html#a2e6c3f8678045bd7fa7273483863fb8e">debug</a>));
<a name="l00136"></a>00136 <span class="preprocessor">#endif</span>
<a name="l00137"></a>00137 <span class="preprocessor"></span>
<a name="l00138"></a>00138     <span class="comment">// Wait for client to be connected if in server mode.</span>
<a name="l00139"></a>00139     <span class="keywordflow">while</span> (<a class="code" href="namespaceurbi.html#a9586227e53bd2feae43f1010afc1d6fa" title="Return the first UClient created by the program.">getDefaultClient</a>()
<a name="l00140"></a>00140            &amp;&amp; !<a class="code" href="namespaceurbi.html#a9586227e53bd2feae43f1010afc1d6fa" title="Return the first UClient created by the program.">getDefaultClient</a>()-&gt;error()
<a name="l00141"></a>00141            &amp;&amp; !<a class="code" href="namespaceurbi.html#a9586227e53bd2feae43f1010afc1d6fa" title="Return the first UClient created by the program.">getDefaultClient</a>()-&gt;isConnected())
<a name="l00142"></a>00142       usleep(20000);
<a name="l00143"></a>00143 
<a name="l00144"></a>00144     <a class="code" href="namespaceurbi.html#abde41f38d8a74367f06a0ebc1fe20fe9">defaultContext</a> = <span class="keyword">new</span> <a class="code" href="classurbi_1_1impl_1_1_remote_u_context_impl.html">impl::RemoteUContextImpl</a>(
<a name="l00145"></a>00145       (<a class="code" href="classurbi_1_1_u_sync_client.html" title="UClient linux implementation with support for synchronous extra functions.">USyncClient</a>*)dynamic_cast&lt;UClient*&gt;(<a class="code" href="namespaceurbi.html#a9586227e53bd2feae43f1010afc1d6fa" title="Return the first UClient created by the program.">getDefaultClient</a>()));
<a name="l00146"></a>00146     <span class="comment">// Waiting for connectionID.</span>
<a name="l00147"></a>00147     <span class="keywordflow">while</span> (<a class="code" href="namespaceurbi.html#a9586227e53bd2feae43f1010afc1d6fa" title="Return the first UClient created by the program.">getDefaultClient</a>()
<a name="l00148"></a>00148            &amp;&amp; <a class="code" href="namespaceurbi.html#a9586227e53bd2feae43f1010afc1d6fa" title="Return the first UClient created by the program.">getDefaultClient</a>()-&gt;connectionID() == <span class="stringliteral">&quot;&quot;</span>)
<a name="l00149"></a>00149     usleep(5000);
<a name="l00150"></a>00150     <span class="comment">// Initialize in the correct thread.</span>
<a name="l00151"></a>00151     <a class="code" href="namespaceurbi.html#a9586227e53bd2feae43f1010afc1d6fa" title="Return the first UClient created by the program.">getDefaultClient</a>()-&gt;<a class="code" href="classurbi_1_1_u_abstract_client.html#a0752fafd9cfaa6f452d0963314c076a9" title="Pass the given UMessage to all registered callbacks with the corresponding tag, as if it were comming...">notifyCallbacks</a>(<a class="code" href="classurbi_1_1_u_message.html" title="Class containing all informations related to an URBI message.">UMessage</a>(*<a class="code" href="namespaceurbi.html#a9586227e53bd2feae43f1010afc1d6fa" title="Return the first UClient created by the program.">getDefaultClient</a>(), 0,
<a name="l00152"></a>00152                              <a class="code" href="namespaceurbi.html#ab84fdc7e8774b4c2586cf315a92b38e6">externalModuleTag</a>.c_str(),
<a name="l00153"></a>00153                              (<span class="stringliteral">&quot;[&quot;</span> + boost::lexical_cast&lt;std::string&gt;(UEM_INIT)
<a name="l00154"></a>00154                                + <span class="stringliteral">&quot;]&quot;</span>).c_str()
<a name="l00155"></a>00155                              ));
<a name="l00156"></a>00156     <span class="comment">// Load initialization files.</span>
<a name="l00157"></a>00157     <span class="keywordflow">foreach</span> (<span class="keyword">const</span> std::string&amp; file, files)
<a name="l00158"></a>00158       <a class="code" href="namespaceurbi.html#a9586227e53bd2feae43f1010afc1d6fa" title="Return the first UClient created by the program.">getDefaultClient</a>()-&gt;<a class="code" href="group___sending.html#ga039f921151de8ed7d078bc1175b907e8" title="Send urbi commands contained in a file.">sendFile</a>(file);
<a name="l00159"></a>00159     <span class="keywordflow">return</span> 0;
<a name="l00160"></a>00160   }
<a name="l00161"></a>00161 
<a name="l00162"></a>00162   <span class="keyword">namespace</span>
<a name="l00163"></a>00163   {
<a name="l00164"></a>00164     <span class="keyword">static</span>
<a name="l00165"></a>00165     <span class="keywordtype">void</span>
<a name="l00166"></a>00166     argument_with_option(<span class="keyword">const</span> <span class="keywordtype">char</span>* longopt,
<a name="l00167"></a>00167                          <span class="keywordtype">char</span> shortopt,
<a name="l00168"></a>00168                          <span class="keyword">const</span> std::string&amp; val)
<a name="l00169"></a>00169     {
<a name="l00170"></a>00170       std::cerr
<a name="l00171"></a>00171         &lt;&lt; program_name()
<a name="l00172"></a>00172         &lt;&lt; <span class="stringliteral">&quot;: warning: arguments without options are deprecated&quot;</span>
<a name="l00173"></a>00173         &lt;&lt; std::endl
<a name="l00174"></a>00174         &lt;&lt; <span class="stringliteral">&quot;use `-&quot;</span> &lt;&lt; shortopt &lt;&lt; <span class="charliteral">&#39; &#39;</span> &lt;&lt; val &lt;&lt; <span class="charliteral">&#39;\&#39;&#39;</span>
<a name="l00175"></a>00175         &lt;&lt; <span class="stringliteral">&quot; or `--&quot;</span> &lt;&lt; longopt &lt;&lt; <span class="charliteral">&#39; &#39;</span> &lt;&lt; val &lt;&lt; <span class="stringliteral">&quot;&#39; instead&quot;</span>
<a name="l00176"></a>00176         &lt;&lt; std::endl
<a name="l00177"></a>00177         &lt;&lt; <span class="stringliteral">&quot;Try `&quot;</span> &lt;&lt; program_name() &lt;&lt; <span class="stringliteral">&quot; --help&#39; for more information.&quot;</span>
<a name="l00178"></a>00178         &lt;&lt; std::endl;
<a name="l00179"></a>00179     }
<a name="l00180"></a>00180 
<a name="l00181"></a>00181   }
<a name="l00182"></a>00182 
<a name="l00183"></a>00183 
<a name="l00184"></a>00184   <a class="code" href="export_8hh.html#ab57e1bcd66a59b3fcf05ff8ec01c1d64">URBI_SDK_API</a> <span class="keywordtype">int</span>
<a name="l00185"></a>00185   <a class="code" href="namespaceurbi.html#a9a0fdc06dc7cc629e189fee3ea92c650" title="Initialisation method using C style arguments.">main</a>(<span class="keyword">const</span> libport::cli_args_type&amp; args, <a class="code" href="class_urbi_root.html">UrbiRoot</a>&amp;, <span class="keywordtype">bool</span> block, <span class="keywordtype">bool</span>)
<a name="l00186"></a>00186   {
<a name="l00187"></a>00187     std::string host = <a class="code" href="classurbi_1_1_u_abstract_client.html#ab01e33f972ab1bff5058b26fc43305ca" title="Default host.">UClient::default_host</a>();
<a name="l00188"></a>00188     <span class="keywordtype">bool</span> exitOnDisconnect = <span class="keyword">true</span>;
<a name="l00189"></a>00189     <span class="keywordtype">int</span> port = UAbstractClient::URBI_PORT;
<a name="l00190"></a>00190     <span class="keywordtype">bool</span> server = <span class="keyword">false</span>;
<a name="l00191"></a>00191     <span class="keywordtype">bool</span> useSyncClient = <span class="keyword">true</span>;
<a name="l00192"></a>00192     <span class="keywordtype">bool</span> describeMode = <span class="keyword">false</span>;
<a name="l00193"></a>00193     std::string describeFile;
<a name="l00194"></a>00194     <span class="keywordtype">size_t</span> buflen = UAbstractClient::URBI_BUFLEN;
<a name="l00195"></a>00195     <span class="comment">// Files to load</span>
<a name="l00196"></a>00196     <a class="code" href="namespaceurbi.html#a47b62fb257e1207893b3fbd9e2a88156">files_type</a> files;
<a name="l00197"></a>00197 
<a name="l00198"></a>00198     <span class="comment">// The number of the next (non-option) argument.</span>
<a name="l00199"></a>00199     <span class="keywordtype">unsigned</span> argp = 1;
<a name="l00200"></a>00200     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 1; i &lt; args.size(); ++i)
<a name="l00201"></a>00201     {
<a name="l00202"></a>00202       <span class="keyword">const</span> std::string&amp; arg = args[i];
<a name="l00203"></a>00203       <span class="keywordflow">if</span> (arg == <span class="stringliteral">&quot;--buffer&quot;</span> || arg == <span class="stringliteral">&quot;-b&quot;</span>)
<a name="l00204"></a>00204         buflen = libport::convert_argument&lt;size_t&gt;(args, i++);
<a name="l00205"></a>00205       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (arg == <span class="stringliteral">&quot;--disconnect&quot;</span> || arg == <span class="stringliteral">&quot;-d&quot;</span>)
<a name="l00206"></a>00206         exitOnDisconnect = <span class="keyword">true</span>;
<a name="l00207"></a>00207       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (arg == <span class="stringliteral">&quot;--file&quot;</span> || arg == <span class="stringliteral">&quot;-f&quot;</span>)
<a name="l00208"></a>00208         files.push_back(libport::convert_argument&lt;const char*&gt;(args, i++));
<a name="l00209"></a>00209       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (arg == <span class="stringliteral">&quot;--stay-alive&quot;</span> || arg == <span class="stringliteral">&quot;-s&quot;</span>)
<a name="l00210"></a>00210         exitOnDisconnect = <span class="keyword">false</span>;
<a name="l00211"></a>00211       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (arg == <span class="stringliteral">&quot;--help&quot;</span> || arg == <span class="stringliteral">&quot;-h&quot;</span>)
<a name="l00212"></a>00212         <a class="code" href="namespaceurbi.html#a522d50415793bfb01630e57fc41b130a">usage</a>();
<a name="l00213"></a>00213       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (arg == <span class="stringliteral">&quot;--host&quot;</span> || arg == <span class="stringliteral">&quot;-H&quot;</span>)
<a name="l00214"></a>00214         host = libport::convert_argument&lt;std::string&gt;(args, i++);
<a name="l00215"></a>00215       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (arg == <span class="stringliteral">&quot;--no-sync-client&quot;</span>)
<a name="l00216"></a>00216         useSyncClient = <span class="keyword">false</span>;
<a name="l00217"></a>00217       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (arg == <span class="stringliteral">&quot;--port&quot;</span> || arg == <span class="stringliteral">&quot;-p&quot;</span>)
<a name="l00218"></a>00218         port = libport::convert_argument&lt;unsigned&gt;(args, i++);
<a name="l00219"></a>00219       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (arg == <span class="stringliteral">&quot;--port-file&quot;</span> || arg == <span class="stringliteral">&quot;-r&quot;</span>)
<a name="l00220"></a>00220         port =
<a name="l00221"></a>00221           (libport::file_contents_get&lt;int&gt;
<a name="l00222"></a>00222            (libport::convert_argument&lt;const char*&gt;(args, i++)));
<a name="l00223"></a>00223       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (arg == <span class="stringliteral">&quot;--server&quot;</span>)
<a name="l00224"></a>00224         server = <span class="keyword">true</span>;
<a name="l00225"></a>00225       <span class="comment">// FIXME: Remove -v some day.</span>
<a name="l00226"></a>00226       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (arg == <span class="stringliteral">&quot;--version&quot;</span> || arg == <span class="stringliteral">&quot;-V&quot;</span> || arg == <span class="stringliteral">&quot;-v&quot;</span>)
<a name="l00227"></a>00227         <a class="code" href="namespaceurbi.html#a22d6748700e48c56d7ba124c0344c13e">version</a>();
<a name="l00228"></a>00228       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (arg == <span class="stringliteral">&quot;--describe&quot;</span>)
<a name="l00229"></a>00229         describeMode = <span class="keyword">true</span>;
<a name="l00230"></a>00230       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (arg == <span class="stringliteral">&quot;--describe-file&quot;</span>)
<a name="l00231"></a>00231          describeFile = libport::convert_argument&lt;const char*&gt;(args, i++);
<a name="l00232"></a>00232       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (arg[0] == <span class="charliteral">&#39;-&#39;</span>)
<a name="l00233"></a>00233         libport::invalid_option(arg);
<a name="l00234"></a>00234       <span class="keywordflow">else</span>
<a name="l00235"></a>00235         <span class="comment">// A genuine argument.</span>
<a name="l00236"></a>00236         <span class="keywordflow">switch</span> (argp++)
<a name="l00237"></a>00237         {
<a name="l00238"></a>00238           <span class="keywordflow">case</span> 1:
<a name="l00239"></a>00239             argument_with_option(<span class="stringliteral">&quot;host&quot;</span>, <span class="charliteral">&#39;H&#39;</span>, args[i]);
<a name="l00240"></a>00240             host = args[i];
<a name="l00241"></a>00241             <span class="keywordflow">break</span>;
<a name="l00242"></a>00242           <span class="keywordflow">case</span> 2:
<a name="l00243"></a>00243             argument_with_option(<span class="stringliteral">&quot;port&quot;</span>, <span class="charliteral">&#39;p&#39;</span>, args[i]);
<a name="l00244"></a>00244             port = libport::convert_argument&lt;unsigned&gt;(<span class="stringliteral">&quot;port&quot;</span>, args[i]);
<a name="l00245"></a>00245             <span class="keywordflow">break</span>;
<a name="l00246"></a>00246           <span class="keywordflow">default</span>:
<a name="l00247"></a>00247             std::cerr &lt;&lt; <span class="stringliteral">&quot;unexpected argument: &quot;</span> &lt;&lt; arg &lt;&lt; std::endl
<a name="l00248"></a>00248                       &lt;&lt; <a class="code" href="namespaceurbi.html#ae2d61f9a8e2c575f660323f0fe01f646" title="Terminate your URBI program.">libport::exit</a>(EX_USAGE);
<a name="l00249"></a>00249         }
<a name="l00250"></a>00250     }
<a name="l00251"></a>00251 
<a name="l00252"></a>00252     <span class="keywordflow">if</span> (describeMode)
<a name="l00253"></a>00253     {
<a name="l00254"></a>00254       <span class="keywordflow">foreach</span>(baseURBIStarter* s, <a class="code" href="classurbi_1_1base_u_r_b_i_starter.html#a92a33ac78bb9a885cb4101fda4bbd107">baseURBIStarter::list</a>())
<a name="l00255"></a>00255         std::cout &lt;&lt; s-&gt;name &lt;&lt; std::endl;
<a name="l00256"></a>00256       <span class="keywordflow">foreach</span>(baseURBIStarterHub* s, <a class="code" href="classurbi_1_1base_u_r_b_i_starter_hub.html#af432ebe14acf770d8f6530a8be885168">baseURBIStarterHub::list</a>())
<a name="l00257"></a>00257         std::cout &lt;&lt; s-&gt;name &lt;&lt; std::endl;
<a name="l00258"></a>00258       <span class="keywordflow">return</span> 0;
<a name="l00259"></a>00259     }
<a name="l00260"></a>00260     <span class="keywordflow">if</span> (!describeFile.empty())
<a name="l00261"></a>00261     {
<a name="l00262"></a>00262       std::ofstream of(describeFile.c_str());
<a name="l00263"></a>00263       <span class="keywordflow">foreach</span>(baseURBIStarter* s, <a class="code" href="classurbi_1_1base_u_r_b_i_starter.html#a92a33ac78bb9a885cb4101fda4bbd107">baseURBIStarter::list</a>())
<a name="l00264"></a>00264         of &lt;&lt; s-&gt;name &lt;&lt; std::endl;
<a name="l00265"></a>00265       <span class="keywordflow">foreach</span>(baseURBIStarterHub* s, <a class="code" href="classurbi_1_1base_u_r_b_i_starter_hub.html#af432ebe14acf770d8f6530a8be885168">baseURBIStarterHub::list</a>())
<a name="l00266"></a>00266         of &lt;&lt; s-&gt;name &lt;&lt; std::endl;
<a name="l00267"></a>00267     }
<a name="l00268"></a>00268     <a class="code" href="namespaceurbi.html#ae40876f9d414812e448a69599fb5dc16">initialize</a>(host, port, buflen, exitOnDisconnect, server, files,
<a name="l00269"></a>00269                useSyncClient);
<a name="l00270"></a>00270 
<a name="l00271"></a>00271     <span class="keywordflow">if</span> (block)
<a name="l00272"></a>00272       <span class="keywordflow">while</span> (<span class="keyword">true</span>)
<a name="l00273"></a>00273         usleep(30000000);
<a name="l00274"></a>00274     <span class="keywordflow">return</span> 0;
<a name="l00275"></a>00275   }
<a name="l00276"></a>00276 
<a name="l00277"></a>00277 }
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
